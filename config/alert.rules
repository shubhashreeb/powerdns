groups:
  - name: prometheus.rules
    rules:
      - alert: AdnsConfigEventError
        annotations:
          summary: 'There are unresolved event errors that need to be manually recovered.'
          description: 'There are unresolved {{$value}} event errors that need to be manually recovered.'
        expr: adns_config_event_error > 0
        for: 0m
        labels:
          severity: critical
      - alert: AdnsConfigNonTransientError
        annotations:
          summary: 'Processing of a customer ADNS configuration resulted in an unrecoverable error over the past 30 minutes. Processing of the configuration is ignored and must be manually recovered.'
          description: 'Processing of a customer ADNS configuration ({{$labels.event_sequence_number}}, {{$labels.zone_name}}, {{$labels.service_instance_id}}, {{$labels.subscription_id}}) resulted in an unrecoverable error of {{$labels.event_type}} category. Error count: {{$value}}.'
        expr: increase(adns_config_err{category="unexpected"}[15m]) > 0 or increase(adns_config_err{category="powerdns_error"}[15m]) > 0
        for: 30m
        labels:
          severity: warning
      - alert: AdnsConfigTransientError
        annotations:
          summary: 'Processing of a customer ADNS configuration resulted in a transient error over the past 30 minutes. Processing of the configuration will be retried.'
          description: 'Processing of a customer ADNS configuration ({{$labels.event_sequence_number}}, {{$labels.zone_name}}, {{$labels.service_instance_id}}, {{$labels.subscription_id}}) resulted in a transient error of {{$labels.event_type}} category. Error count: {{$value}}.'
        expr: increase(adns_config_err{category="database_retry_timeout"}[15m]) > 0 or increase(adns_config_err{category="powerdns_retry_timeout"}[15m]) > 0
        for: 30m
        labels:
          severity: warning
